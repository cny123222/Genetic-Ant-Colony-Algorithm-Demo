# Round 4 vs Round 6 对比分析

## 配置对比

| 参数 | Round 4 | Round 6 |
|------|---------|---------|
| 种群大小 | 180 | 180 ✓ |
| 训练代数 | 400 | 400 ✓ |
| 变异率 | 0.25 | 0.25 ✓ |
| 精英比例 | 0.015 | 0.015 ✓ |
| **地形模式** | **随机** | **固定5个地形** ⚠️ |
| **评估方式** | **1次随机地形** | **5个地形平均** ⚠️ |

## 训练进展对比（前60代）

### Round 6 (固定地形)
```
Gen 1:  -55.26  ← NEW RECORD
Gen 2:  -45.95  ← NEW RECORD
Gen 12: -41.95  ← NEW RECORD
Gen 19: -39.43  ← NEW RECORD
Gen 20: -36.10  ← NEW RECORD (当前最佳)
Gen 21-60: 无突破 (停滞40代) ❌
```

**突破频率**: 5次 / 60代 = 8.3%

### Round 4 (随机地形) - 回顾
```
最终最佳: 153.29 (Gen 336)
总突破: 16次 / 400代 = 4%
后期停滞: Gen 336-400 (64代无突破)
```

## 🚨 异常发现

### 1. Fitness数值差异巨大

**Round 6**: 最佳 = -36.10 (仍然是负数)
**Round 4**: 最佳 = 153.29 (正数，且很高)

**差异**: ~190分！

### 2. 早期停滞

- Round 6在Gen 20后就停滞了40代
- 比Round 4的停滞（Gen 336后）来得更早
- 说明可能陷入了更差的局部最优

### 3. 评估方式改变的影响

#### Round 4评估
```python
# 1个随机地形
env.reset()  # 随机seed
fitness = single_run_reward
```

#### Round 6评估
```python
# 5个固定地形的平均
terrains = [42, 123, 456, 789, 1024]
rewards = [run(seed) for seed in terrains]
fitness = mean(rewards)  # 平均值
```

**关键问题**: 
- 如果5个地形中有很难的，会拉低平均分
- 平均分 ≠ 最好表现
- 可能抑制了优秀个体的选拔

## 可能的问题

### 问题1: 固定地形太难 ⚠️
```
seed=42:   可能是困难地形
seed=123:  可能是困难地形
seed=456:  可能是困难地形
...

结果：5个地形都很难 → fitness永远是负数
```

### 问题2: 平均分策略不佳 ⚠️
```
个体A: [100, -100, -100, -100, -100] → 平均 -60
个体B: [-50, -50, -50, -50, -50]    → 平均 -50

选择：B被选中（但B在所有地形都表现差）
理想：A应该被选中（至少在一个地形上能走）
```

### 问题3: 初始化运气 ⚠️
Round 6的初始种群可能正好都不适应这5个固定地形

## 数据验证

让我们检查一下这5个固定地形是否合理：

```python
TERRAIN_SEEDS = [42, 123, 456, 789, 1024]
```

需要验证：
- 这5个seed生成的地形难度如何？
- 一个随机策略在这些地形上能得多少分？
- 是否所有地形都太难？

## 建议的调整方案

### 方案A: 选择简单地形 ✅
```python
# 手动测试找出简单的地形
TERRAIN_SEEDS = [999, 777, 555, 333, 111]  # 需要测试
```

### 方案B: 只用1个固定地形 ✅
```python
# 最简单：只在1个地形上训练
TERRAIN_SEEDS = [42]  # 单一地形
```

### 方案C: 回到随机但固定seed ✅
```python
# 每代使用相同的随机seed
np.random.seed(42)  # 固定随机种子
env.reset()  # 每次reset都会生成相同的"随机"地形
```

### 方案D: 改用最大值而非平均 ✅
```python
# 取5个地形中的最好表现
fitness = max(rewards)  # 而不是 mean(rewards)
```

## 当前决策

**建议**: 先用方案B（单一固定地形）快速验证

理由：
1. 最简单，排除多地形复杂性
2. 如果单地形都训练不好，说明参数有问题
3. 如果单地形训练好了，再考虑多地形

## 预期结果

如果使用单一固定地形（seed=42）：
- 应该能达到Round 4的水平（~150+）
- 训练曲线应该更平滑
- 视频完全可对比

如果还是不行：
- 说明seed=42的地形可能太难
- 需要测试不同的seed找简单地形

